#!/usr/bin/env tsx
/**
 * Test Polymarket CLOB SDK Integration
 * Verifies the SDK is working without executing real trades
 */

import { polymarketClobSDK } from '../lib/polymarket/clob-sdk-client'

const TEST_TOKEN_ID = '87799116847875103478187928629916244342473925209287684667136064599163447151038'
const TEST_SAFE = '0x7915Dd2AB1af795310cCD0D3598bBc8BC4f3d6a3'

async function main() {
  console.log('üß™ Testing Polymarket CLOB SDK Integration\n')
  console.log('‚ïê'.repeat(70))

  // Test 1: Fetch Order Book
  console.log('\nüìä Test 1: Fetch Order Book')
  console.log('‚îÄ'.repeat(70))
  try {
    const orderBook = await polymarketClobSDK.getOrderBook(TEST_TOKEN_ID)
    if (orderBook) {
      console.log('‚úÖ Order book fetched successfully')
      console.log(`   Best Ask: $${orderBook.asks[0]?.price} (${orderBook.asks[0]?.size} shares)`)
      console.log(`   Best Bid: $${orderBook.bids[0]?.price} (${orderBook.bids[0]?.size} shares)`)
      console.log(`   Tick Size: ${orderBook.tick_size}`)
      console.log(`   Neg Risk: ${orderBook.neg_risk}`)
    } else {
      console.log('‚ùå Failed to fetch order book')
    }
  } catch (error: any) {
    console.log('‚ùå Error:', error.message)
  }

  // Test 2: Check Liquidity
  console.log('\nüíß Test 2: Check Liquidity')
  console.log('‚îÄ'.repeat(70))
  try {
    const liquidity = await polymarketClobSDK.checkLiquidity(TEST_TOKEN_ID, 'BUY', 0.10)
    console.log(`‚úÖ Liquidity check complete`)
    console.log(`   Has Liquidity: ${liquidity.hasLiquidity ? '‚úÖ Yes' : '‚ùå No'}`)
    console.log(`   Available Size: $${liquidity.availableSize.toFixed(2)} USDC`)
  } catch (error: any) {
    console.log('‚ùå Error:', error.message)
  }

  // Test 3: Calculate Share Size
  console.log('\nüî¢ Test 3: Calculate Share Size')
  console.log('‚îÄ'.repeat(70))
  try {
    const shares = await polymarketClobSDK.calculateShareSize(TEST_TOKEN_ID, 'BUY', 0.10)
    if (shares) {
      console.log(`‚úÖ Share calculation complete`)
      console.log(`   For $0.10 USDC ‚Üí ${shares} shares`)
    } else {
      console.log('‚ùå Could not calculate share size')
    }
  } catch (error: any) {
    console.log('‚ùå Error:', error.message)
  }

  // Test 4: Environment Check
  console.log('\nüîê Test 4: Environment Configuration')
  console.log('‚îÄ'.repeat(70))
  const operatorKey = process.env.OPERATOR_PRIVATE_KEY
  const apiUrl = process.env.POLYMARKET_API_URL || 'https://clob.polymarket.com'

  console.log(`   OPERATOR_PRIVATE_KEY: ${operatorKey ? '‚úÖ Set' : '‚ùå Not set'}`)
  console.log(`   POLYMARKET_API_URL: ${apiUrl}`)
  console.log(`   Test Safe Address: ${TEST_SAFE}`)

  console.log('\n‚ïê'.repeat(70))
  console.log('\nüìã Summary:\n')
  console.log('The SDK integration is working correctly for read operations.')
  console.log('To test actual trade execution:')
  console.log('  1. Ensure USDC is in your Safe')
  console.log('  2. Restart websocket listener: npx tsx scripts/websocket-listener.ts')
  console.log('  3. Wait for a trade from followed trader')
  console.log('  4. Monitor logs for SDK execution')
  console.log()
  console.log('‚ö†Ô∏è  Note: This script does NOT execute real trades!')
  console.log('   It only tests read operations (order book, liquidity, etc.)')
  console.log()
  console.log('‚ïê'.repeat(70))
}

main().catch(console.error)
